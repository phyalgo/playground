<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Snake</title>
  <!-- p5.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
  <style>
    /* Global Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      font-family: monospace;
    }
    
    /* True Light/Dark Mode:
       Dark mode: dark background with white text and borders.
       Light mode: light background with black text and borders. */
    body.dark-mode {
      background-color: #181a1b;
      color: #fff;
    }
    body.light-mode {
      background-color: #f5f5f5;
      color: #000;
    }
    
    /* Main Container: centers the game container and side menu side by side */
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px; /* even margin between containers */
      width: 100vw;
      height: 100vh;
    }
    
    /* Game Container (Floating Card) – fixed at 601×601 */
    #game-container {
      width: 601px;
      height: 601px;
      border: 2px solid currentColor;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      overflow: hidden;
      background-color: inherit;
    }
    /* The canvas fills the game container exactly; pixelated rendering ensures crispness */
    canvas {
      display: block;
      image-rendering: pixelated;
    }
    
    /* Side Menu (Floating Card) – fixed at 300×601 to match the game container’s height */
    .sidebar {
      width: 300px;
      height: 601px;
      padding: 20px;
      border: 2px solid currentColor;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      background-color: inherit;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 20px;
    }
    
    /* --- Top Section: Score Boxes (Stacked) --- */
    .score-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .score-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 1rem;
    }
    
    /* --- Middle Section: Food Types --- */
    .food-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 10px;
      font-size: 1rem;
    }
    .food-box h3 {
      text-align: center;
      margin-bottom: 10px;
    }
    /* Using a table to control alignment:
       - The table is centered in the food box.
       - The red apple row appears above the golden apple row.
       - Both rows’ text is left-aligned within the table cell. */
    .food-table {
      margin: 0 auto;
      border-collapse: collapse;
      width: auto;
      text-align: left;
    }
    .food-table td {
      padding: 5px 0;
    }
    .color-block {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-right: 8px;
      vertical-align: middle;
      border-radius: 3px;
      border: 1px solid currentColor;
    }
    
    /* --- Bottom Section: Controls --- */
    .control-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .game-controls {
      display: flex;
      gap: 10px;
    }
    .control-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 5px 10px;
      text-align: center;
      font-size: 1rem;
    }
    .control-box button {
      background: none;
      border: none;
      font-family: inherit;
      font-size: inherit;
      color: inherit;
      cursor: pointer;
    }
    /* Theme Toggle: Separate boxed button */
    .theme-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
    .theme-box button {
      background: none;
      border: none;
      cursor: pointer;
      color: inherit;
    }
    
    /* In Light Mode, force borders and text to black */
    body.light-mode .score-box,
    body.light-mode .food-box,
    body.light-mode .control-box,
    body.light-mode .theme-box {
      border: 2px solid #000;
    }
  </style>
</head>
<body class="dark-mode">
  <div class="container">
    <!-- Game Container -->
    <div id="game-container"></div>
    
    <!-- Side Menu -->
    <div class="sidebar">
      <!-- Top Section: Score Boxes -->
      <div class="score-section">
        <div class="score-box" id="score-box">
          <h3>Score</h3>
          <p id="score">0</p>
        </div>
        <div class="score-box" id="last-score-box">
          <h3>Last Score</h3>
          <p id="last-score">0</p>
        </div>
        <div class="score-box" id="highest-score-box">
          <h3>Highest Score</h3>
          <p id="highest-score">0</p>
        </div>
      </div>
      
      <!-- Middle Section: Food Types -->
      <div class="food-box">
        <h3>Food Types</h3>
        <table class="food-table">
          <tr>
            <td>
              <span class="color-block" style="background-color: #A94442;"></span>
              Red Apple: 10 pts
            </td>
          </tr>
          <tr>
            <td>
              <span class="color-block" style="background-color: #BFA06B;"></span>
              Golden Apple: 30 pts
            </td>
          </tr>
        </table>
      </div>
      
      <!-- Bottom Section: Controls -->
      <div class="control-section">
        <div class="game-controls">
          <div class="control-box">
            <button id="start-btn">Start</button>
          </div>
          <div class="control-box">
            <button id="pause-btn">Pause</button>
          </div>
        </div>
        <div class="theme-box">
          <button id="toggle-mode-btn"></button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Ensure crisp, unblurred rendering.
    function setupPixelDensity() {
      pixelDensity(1);
      noSmooth();
    }
    
    // Define theme toggle icons using currentColor.
    const sunIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';
    const moonIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>';
    // Set the initial toggle icon (in dark mode, currentColor is white).
    document.getElementById("toggle-mode-btn").innerHTML = moonIcon;
    
    // We want a 25×25 grid inside a 600×600 container.
    // Each cell is 600/25 = 24px.
    const cols = 25;
    const rows = 25;
    const gridSize = 600 / 25; // 24px per cell
    const canvasWidth = 600;  // game container is 600px wide
    const canvasHeight = 600; // game container is 600px high
    
    let snake;
    let food;
    let score = 0;
    let lastScore = 0;
    let highestScore = 0;
    let gameState = "stopped"; // "stopped", "running", "paused", "gameover"
    
    function setup() {
      setupPixelDensity();
      canvas = createCanvas(canvasWidth, canvasHeight);
      canvas.parent("game-container");
      frameRate(10);
      initGame();
    }
    
    function draw() {
      // Set background based on current theme.
      if (document.body.classList.contains("light-mode")) {
        background(245);
      } else {
        background(24, 26, 27);
      }
      
      // Draw vertical grid lines.
      if (document.body.classList.contains("light-mode")) {
        stroke(200);
      } else {
        stroke(48, 51, 54);
      }
      for (let i = 0; i <= cols; i++) {
        let x = i * gridSize;
        // Ensure the rightmost line is drawn at x = 600 - 1
        if (i === cols) x = canvasWidth - 1;
        line(x, 0, x, canvasHeight);
      }
      // Draw horizontal grid lines.
      for (let j = 0; j <= rows; j++) {
        let y = j * gridSize;
        if (j === rows) y = canvasHeight - 1;
        line(0, y, canvasWidth, y);
      }
      
      // Draw food.
      if (food.type === "apple") {
        drawApple(food.x, food.y);
      } else if (food.type === "goldenApple") {
        drawGoldenApple(food.x, food.y);
      }
      
      // Update snake if game is running.
      if (gameState === "running") {
        snake.move();
      }
      snake.show();
      
      // Update current score in the side menu.
      document.getElementById("score").innerText = score;
      
      // If game over, overlay a theme-based "GAME OVER" message.
      if (gameState === "gameover") {
        push();
        if (document.body.classList.contains("dark-mode")) {
          fill(255, 255, 255, 150); // semi-transparent white
          var textFill = 0;
        } else {
          fill(0, 0, 0, 150);       // semi-transparent black
          var textFill = 255;
        }
        rect(0, 0, canvasWidth, canvasHeight);
        textAlign(CENTER, CENTER);
        textSize(48);
        fill(textFill);
        text("GAME OVER", canvasWidth / 2, canvasHeight / 2);
        pop();
      }
    }
    
    function initGame() {
      snake = new Snake();
      food = createFood();
      score = 0;
      updateScore();
      gameState = "stopped";
      document.getElementById("start-btn").innerText = "Start";
      document.getElementById("pause-btn").innerText = "Pause";
    }
    
    function createFood() {
      let rand = random();
      let type = (rand < 0.7) ? "apple" : "goldenApple";
      let foodX = floor(random(cols)) * gridSize;
      let foodY = floor(random(rows)) * gridSize;
      return { x: foodX, y: foodY, type: type };
    }
    
    class Snake {
      constructor() {
        this.body = [createVector(floor(canvasWidth / (2 * gridSize)) * gridSize, floor(canvasHeight / (2 * gridSize)) * gridSize)];
        this.dir = createVector(gridSize, 0);
        this.growth = 0;
      }
      move() {
        let newHead = p5.Vector.add(this.body[0], this.dir);
        if (newHead.x < 0 || newHead.x >= canvasWidth || newHead.y < 0 || newHead.y >= canvasHeight) {
          gameOver();
          return;
        }
        for (let segment of this.body) {
          if (segment.equals(newHead)) {
            gameOver();
            return;
          }
        }
        this.body.unshift(newHead);
        if (newHead.x === food.x && newHead.y === food.y) {
          if (food.type === "apple") {
            score += 10;
            this.growth += 1;
          } else if (food.type === "goldenApple") {
            score += 30;
            this.growth += 3;
          }
          updateScore();
          food = createFood();
        }
        if (this.growth > 0) {
          this.growth--;
        } else {
          this.body.pop();
        }
      }
      show() {
        fill("#3C4F65"); // Dark grey-blue.
        noStroke();
        for (let segment of this.body) {
          rect(segment.x, segment.y, gridSize, gridSize, 5);
        }
      }
    }
    
    function drawApple(x, y) {
      fill("#A94442"); // Dark, muted red.
      noStroke();
      rect(x, y, gridSize, gridSize, 5);
    }
    
    function drawGoldenApple(x, y) {
      fill("#BFA06B"); // Darker, greyish yellow.
      noStroke();
      rect(x, y, gridSize, gridSize, 5);
    }
    
    function updateScore() {
      document.getElementById("score").innerText = score;
    }
    
    function gameOver() {
      gameState = "gameover";
      lastScore = score;
      document.getElementById("last-score").innerText = lastScore;
      if (score > highestScore) {
        highestScore = score;
        document.getElementById("highest-score").innerText = highestScore;
      }
      document.getElementById("start-btn").innerText = "Start";
    }
    
    function keyPressed() {
      if ((keyCode === UP_ARROW || key === 'w' || key === 'W') && snake.dir.y === 0) {
        snake.dir.set(0, -gridSize);
      } else if ((keyCode === DOWN_ARROW || key === 's' || key === 'S') && snake.dir.y === 0) {
        snake.dir.set(0, gridSize);
      } else if ((keyCode === LEFT_ARROW || key === 'a' || key === 'A') && snake.dir.x === 0) {
        snake.dir.set(-gridSize, 0);
      } else if ((keyCode === RIGHT_ARROW || key === 'd' || key === 'D') && snake.dir.x === 0) {
        snake.dir.set(gridSize, 0);
      }
    }
    
    window.addEventListener("keydown", function(e) {
      if ([37,38,39,40].includes(e.keyCode)) { e.preventDefault(); }
    });
    
    document.getElementById("start-btn").addEventListener("click", function() {
      initGame();
      gameState = "running";
      this.innerText = "Restart";
    });
    
    document.getElementById("pause-btn").addEventListener("click", function() {
      if (gameState === "running") {
        gameState = "paused";
        this.innerText = "Unpause";
      } else if (gameState === "paused") {
        gameState = "running";
        this.innerText = "Pause";
      }
    });
    
    document.getElementById("toggle-mode-btn").addEventListener("click", function() {
      if (document.body.classList.contains("dark-mode")) {
        document.body.classList.remove("dark-mode");
        document.body.classList.add("light-mode");
        this.innerHTML = sunIcon;
      } else {
        document.body.classList.remove("light-mode");
        document.body.classList.add("dark-mode");
        this.innerHTML = moonIcon;
      }
    });
  </script>
</body>
</html>
