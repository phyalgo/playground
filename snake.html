<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Snake</title>
  <!-- p5.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
  <style>
    /* Global Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { 
      height: 100%; 
      font-family: monospace; 
      overscroll-behavior: contain;
      touch-action: none;
    }
    
    /* Light/Dark Themes */
    body.dark-mode {
      background-color: #181a1b;
      color: #fff;
    }
    body.light-mode {
      background-color: #f5f5f5;
      color: #000;
    }
    
    /* Main Container */
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      width: 100vw;
      height: 100vh;
      padding: 20px;
    }
    
    /* Game Container */
    #game-container {
      width: 601px;
      height: 601px;
      border: 2px solid currentColor;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      overflow: hidden;
      background-color: inherit;
      order: 1;
    }
    canvas {
      display: block;
      image-rendering: pixelated;
    }
    
    /* Side Menu */
    .sidebar {
      width: 300px;
      height: 601px;
      padding: 20px;
      border: 2px solid currentColor;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      background-color: inherit;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 20px;
      order: 2;
    }
    
    /* Return to Playground Button */
    .return-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 1rem;
      margin-bottom: 10px;
    }
    .return-box a {
      color: inherit;
      text-decoration: none;
      display: block;
      width: 100%;
      height: 100%;
    }
    
    /* Score Boxes */
    .score-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .score-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 1rem;
    }
    
    /* Instructions */
    .instructions-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 10px;
      font-size: 0.9rem;
    }
    .instructions-box h3 {
      text-align: center;
      margin-bottom: 10px;
    }
    .instructions-box ol {
      margin-left: 20px;
      margin-bottom: 10px;
    }
    .instructions-box li {
      margin-bottom: 5px;
    }
    .food-info {
      border-top: 1px solid currentColor;
      padding-top: 10px;
      margin-top: 5px;
    }
    .food-table {
      width: 100%;
      margin-top: 5px;
    }
    .food-table td {
      padding: 3px 0;
    }
    .color-block {
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-right: 8px;
      vertical-align: middle;
      border-radius: 3px;
      border: 1px solid currentColor;
    }

    /* Controls */
    .control-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .game-controls {
      display: flex;
      gap: 10px;
    }
    .control-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 5px 10px;
      text-align: center;
      font-size: 1rem;
    }
    .control-box button {
      background: none;
      border: none;
      font-family: inherit;
      font-size: inherit;
      color: inherit;
      cursor: pointer;
    }
    /* Theme Toggle */
    .theme-box {
      border: 2px solid currentColor;
      border-radius: 8px;
      padding: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
    .theme-box button {
      background: none;
      border: none;
      cursor: pointer;
      color: inherit;
    }
    
    /* Light Mode adjustments */
    body.light-mode .score-box,
    body.light-mode .instructions-box,
    body.light-mode .control-box,
    body.light-mode .theme-box,
    body.light-mode .return-box {
      border: 2px solid #000;
    }

    /* Mobile Rules (show/hide based on device) */
    .mobile-rules { display: none; }
    .desktop-rules { display: block; }

    /* Mobile Responsive Layout */
    @media (max-width: 1000px) {
      .container {
        flex-direction: column;
        padding: 5px;
        gap: 10px;
        height: auto;
      }

      .sidebar {
        width: 98%;
        max-width: 600px;
        height: auto;
        min-height: auto;
        padding: 10px;
        gap: 10px;
        order: 1;
      }

      #game-container {
        width: 98%;
        max-width: 600px;
        height: auto;
        aspect-ratio: 1;
        order: 2;
      }

      canvas {
        width: 100% !important;
        height: 100% !important;
      }

      .score-section {
        flex-direction: row;
        justify-content: space-between;
        gap: 5px;
      }

      .score-box {
        flex: 1;
        padding: 5px;
      }

      .instructions-box {
        padding: 8px;
      }

      .mobile-rules { display: block; }
      .desktop-rules { display: none; }

      .control-section {
        gap: 5px;
      }

      .game-controls {
        gap: 5px;
      }

      .return-box {
        margin-bottom: 5px;
        padding: 5px;
      }
    }

    /* Extra Small Devices */
    @media (max-width: 480px) {
      .container {
        padding: 3px;
      }

      .sidebar {
        padding: 8px;
      }

      .score-section {
        gap: 3px;
      }

      .score-box h3 {
        font-size: 0.9rem;
      }

      .instructions-box {
        font-size: 0.8rem;
      }

      .control-box {
        padding: 3px 8px;
      }
    }
  </style>
</head>
<body class="light-mode">
  <div class="container">
    <!-- Game Container -->
    <div id="game-container"></div>
    
    <!-- Side Menu -->
    <div class="sidebar">
      <!-- Return to Playground -->
      <div class="return-box">
        <a href="https://phyalgo.github.io/playground/">Return to Playground</a>
      </div>

      <!-- Score Boxes -->
      <div class="score-section">
        <div class="score-box" id="score-box">
          <h3>Score</h3>
          <p id="score">0</p>
        </div>
        <div class="score-box" id="last-score-box">
          <h3>Last Score</h3>
          <p id="last-score">0</p>
        </div>
        <div class="score-box" id="highest-score-box">
          <h3>High Score</h3>
          <p id="highest-score">0</p>
        </div>
      </div>
      
      <!-- Instructions -->
      <div class="instructions-box">
        <h3>Instructions:</h3>
        <div class="desktop-rules">
          <ol>
            <li>Use WASD or arrow keys to move snake</li>
            <li>Avoid hitting walls or yourself</li>
          </ol>
        </div>
        <div class="mobile-rules">
          <ol>
            <li>Swipe to move snake</li>
            <li>Avoid hitting walls or yourself</li>
          </ol>
        </div>
        <div class="food-info">
          <table class="food-table">
            <tr>
              <td>
                <span class="color-block" style="background-color: #A94442;"></span>
                Red Apple: 10 pts
              </td>
            </tr>
            <tr>
              <td>
                <span class="color-block" style="background-color: #BFA06B;"></span>
                Golden Apple: 30 pts
              </td>
            </tr>
          </table>
        </div>
      </div>
      
      <!-- Controls -->
      <div class="control-section">
        <div class="game-controls">
          <div class="control-box">
            <button id="start-btn">Start</button>
          </div>
          <div class="control-box">
            <button id="pause-btn">Pause</button>
          </div>
        </div>
        <div class="theme-box">
          <button id="toggle-mode-btn"></button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Theme toggle icons
    const sunIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>';
    const moonIcon = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg>';
    document.getElementById("toggle-mode-btn").innerHTML = sunIcon;
    
    // Check if device is mobile
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    // Show/hide appropriate instructions
    document.querySelector('.mobile-rules').style.display = isMobile ? 'block' : 'none';
    document.querySelector('.desktop-rules').style.display = isMobile ? 'none' : 'block';
    
    // Touch handling variables
    let touchStartX = null;
    let touchStartY = null;
    const MIN_SWIPE = 30;
    
    // Game configuration
    const DESKTOP_GRID = 25;
    const MOBILE_GRID = 15;
    const cols = isMobile ? MOBILE_GRID : DESKTOP_GRID;
    const rows = isMobile ? MOBILE_GRID : DESKTOP_GRID;
    let gridSize = 600 / (isMobile ? MOBILE_GRID : DESKTOP_GRID);
    let canvasWidth = 600;
    let canvasHeight = 600;
    
    // Adjust canvas size for mobile
    if (isMobile) {
      const gameContainer = document.getElementById('game-container');
      const containerWidth = gameContainer.clientWidth;
      canvasWidth = containerWidth - 4; // Account for border
      canvasHeight = canvasWidth;
      gridSize = canvasWidth / MOBILE_GRID;
    }
    
    // Game variables
    let snake;
    let food;
    let score = 0;
    let lastScore = 0;
    let highScore = 0;
    let gameState = "stopped";
    
    function setupPixelDensity() {
      pixelDensity(1);
      noSmooth();
    }
    
    function setup() {
      const canvas = createCanvas(canvasWidth, canvasHeight);
      canvas.parent("game-container");
      setupPixelDensity();
      frameRate(isMobile ? 7 : 10); // Slower on mobile
      initGame();

      if (isMobile) {
        // Add touch event listeners
        const canvasElement = document.querySelector("#game-container canvas");
        canvasElement.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvasElement.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvasElement.addEventListener('touchend', handleTouchEnd, { passive: false });
      }
    }

    // Touch handlers
    function handleTouchStart(evt) {
      evt.preventDefault();
      const touch = evt.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
    }

    function handleTouchMove(evt) {
      evt.preventDefault();
      if (!touchStartX || !touchStartY || gameState !== "running") return;

      const touch = evt.touches[0];
      const deltaX = touch.clientX - touchStartX;
      const deltaY = touch.clientY - touchStartY;

      if (Math.abs(deltaX) > MIN_SWIPE || Math.abs(deltaY) > MIN_SWIPE) {
        if (Math.abs(deltaX) > Math.abs(deltaY)) {
          // Horizontal swipe
          if (deltaX > 0 && snake.dir.x === 0) {
            snake.dir.set(gridSize, 0); // Right
          } else if (deltaX < 0 && snake.dir.x === 0) {
            snake.dir.set(-gridSize, 0); // Left
          }
        } else {
          // Vertical swipe
          if (deltaY > 0 && snake.dir.y === 0) {
            snake.dir.set(0, gridSize); // Down
          } else if (deltaY < 0 && snake.dir.y === 0) {
            snake.dir.set(0, -gridSize); // Up
          }
        }
        touchStartX = null;
        touchStartY = null;
      }
    }

    function handleTouchEnd(evt) {
      evt.preventDefault();
      touchStartX = null;
      touchStartY = null;
    }
    
    function draw() {
      // Set background based on theme
      if (document.body.classList.contains("light-mode")) {
        background(245);
      } else {
        background(24, 26, 27);
      }
      
      // Draw grid lines
      if (document.body.classList.contains("light-mode")) {
        stroke(200);
      } else {
        stroke(48, 51, 54);
      }
      
      // Draw vertical lines
      for (let i = 0; i <= cols; i++) {
        let x = i * gridSize;
        if (i === cols) x = canvasWidth - 1;
        line(x, 0, x, canvasHeight);
      }
      
      // Draw horizontal lines
      for (let j = 0; j <= rows; j++) {
        let y = j * gridSize;
        if (j === rows) y = canvasHeight - 1;
        line(0, y, canvasWidth, y);
      }
      
      // Draw food
      if (food.type === "apple") {
        drawApple(food.x, food.y);
      } else if (food.type === "goldenApple") {
        drawGoldenApple(food.x, food.y);
      }
      
      // Update and show snake
      if (gameState === "running") {
        snake.move();
      }
      snake.show();
      
      // Update score display
      document.getElementById("score").innerText = score;
      
      // Game over overlay
      if (gameState === "gameover") {
        push();
        if (document.body.classList.contains("dark-mode")) {
          fill(255, 255, 255, 150);
          var textFill = 0;
        } else {
          fill(0, 0, 0, 150);
          var textFill = 255;
        }
        rect(0, 0, canvasWidth, canvasHeight);
        textAlign(CENTER, CENTER);
        textSize(48);
        fill(textFill);
        text("GAME OVER", canvasWidth / 2, canvasHeight / 2);
        pop();
      }
    }
    
    function initGame() {
      snake = new Snake();
      food = createFood();
      score = 0;
      updateScore();
      gameState = "stopped";
      document.getElementById("start-btn").innerText = "Start";
      document.getElementById("pause-btn").innerText = "Pause";
    }
    
    function createFood() {
      let rand = random();
      let type = (rand < 0.7) ? "apple" : "goldenApple";
      let foodX = floor(random(cols)) * gridSize;
      let foodY = floor(random(rows)) * gridSize;
      return { x: foodX, y: foodY, type: type };
    }
    
    class Snake {
      constructor() {
        this.body = [createVector(floor(canvasWidth / (2 * gridSize)) * gridSize, 
                                floor(canvasHeight / (2 * gridSize)) * gridSize)];
        this.dir = createVector(gridSize, 0);
        this.growth = 0;
      }
      
      move() {
        let newHead = p5.Vector.add(this.body[0], this.dir);
        if (newHead.x < 0 || newHead.x >= canvasWidth || 
            newHead.y < 0 || newHead.y >= canvasHeight) {
          gameOver();
          return;
        }
        
        for (let segment of this.body) {
          if (segment.equals(newHead)) {
            gameOver();
            return;
          }
        }
        
        this.body.unshift(newHead);
        if (newHead.x === food.x && newHead.y === food.y) {
          if (food.type === "apple") {
            score += 10;
            this.growth += 1;
          } else if (food.type === "goldenApple") {
            score += 30;
            this.growth += 3;
          }
          updateScore();
          food = createFood();
        }
        
        if (this.growth > 0) {
          this.growth--;
        } else {
          this.body.pop();
        }
      }
      
      show() {
        fill("#3C4F65");
        noStroke();
        for (let segment of this.body) {
          rect(segment.x, segment.y, gridSize, gridSize, 5);
        }
      }
    }
    
    function drawApple(x, y) {
      fill("#A94442");
      noStroke();
      rect(x, y, gridSize, gridSize, 5);
    }
    
    function drawGoldenApple(x, y) {
      fill("#BFA06B");
      noStroke();
      rect(x, y, gridSize, gridSize, 5);
    }
    
    function updateScore() {
      document.getElementById("score").innerText = score;
    }
    
    function gameOver() {
      gameState = "gameover";
      lastScore = score;
      document.getElementById("last-score").innerText = lastScore;
      if (score > highScore) {
        highScore = score;
        document.getElementById("highest-score").innerText = highScore;
      }
      document.getElementById("start-btn").innerText = "Start";
    }
    
    function keyPressed() {
      if (gameState !== "running") return;
      
      if ((keyCode === UP_ARROW || key === 'w' || key === 'W') && snake.dir.y === 0) {
        snake.dir.set(0, -gridSize);
      } else if ((keyCode === DOWN_ARROW || key === 's' || key === 'S') && snake.dir.y === 0) {
        snake.dir.set(0, gridSize);
      } else if ((keyCode === LEFT_ARROW || key === 'a' || key === 'A') && snake.dir.x === 0) {
        snake.dir.set(-gridSize, 0);
      } else if ((keyCode === RIGHT_ARROW || key === 'd' || key === 'D') && snake.dir.x === 0) {
        snake.dir.set(gridSize, 0);
      }
    }
    
    // Prevent arrow key scrolling
    window.addEventListener("keydown", function(e) {
      if([37, 38, 39, 40].includes(e.keyCode)) {
        e.preventDefault();
      }
    });
    
    // Start/Restart button
    document.getElementById("start-btn").addEventListener("click", function() {
      initGame();
      gameState = "running";
      this.innerText = "Restart";
    });
    
    // Pause button
    document.getElementById("pause-btn").addEventListener("click", function() {
      if (gameState === "running") {
        gameState = "paused";
        this.innerText = "Unpause";
      } else if (gameState === "paused") {
        gameState = "running";
        this.innerText = "Pause";
      }
    });
    
    // Theme toggle
    document.getElementById("toggle-mode-btn").addEventListener("click", function() {
      if (document.body.classList.contains("dark-mode")) {
        document.body.classList.remove("dark-mode");
        document.body.classList.add("light-mode");
        this.innerHTML = sunIcon;
      } else {
        document.body.classList.remove("light-mode");
        document.body.classList.add("dark-mode");
        this.innerHTML = moonIcon;
      }
    });
  </script>
</body>
</html>
